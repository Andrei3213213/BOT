
import os
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import ApplicationBuilder, CommandHandler, CallbackQueryHandler, ContextTypes, MessageHandler, filters

CANDLES = {
    "—Å–≤–µ–∂–∏–µ": [
        ("–õ–∏–º–æ–Ω—ã–π –±—Ä–∏–∑", "üçã –º—è—Ç–∞, –ª–∏–º–æ–Ω–Ω—ã–π –ª–∏—Å—Ç"),
        ("–°–æ–ª–Ω–µ—á–Ω—ã–π –º–∞–Ω–¥–∞—Ä–∏–Ω", "üçä –±–µ—Ä–≥–∞–º–æ—Ç, –Ω–µ—Ä–æ–ª–∏, –º–∞–Ω–¥–∞—Ä–∏–Ω, –º–æ—Ä—Å–∫–∞—è —Å–æ–ª—å"),
        ("–¢—É–º–∞–Ω–Ω—ã–π —Ä–∞—Å—Å–≤–µ—Ç", "üå´ –æ–∑–æ–Ω, –ª–∏–º–æ–Ω, —è–±–ª–æ–∫–æ, —à–∞–ª—Ñ–µ–π, —ç–≤–∫–∞–ª–∏–ø—Ç"),
        ("–î–µ–Ω—å –≤ SPA", "üíÜ –ª–µ–º–æ–Ω–≥—Ä–∞—Å—Å, —á—ë—Ä–Ω–∞—è —Å–º–æ—Ä–æ–¥–∏–Ω–∞, –ø–∞—á—É–ª–∏"),
        ("–°–æ–ª–Ω–µ—á–Ω—ã–µ —Ü–≤–µ—Ç—ã (–≤–µ—Ä—Ö–Ω–∏–µ)", "‚òÄÔ∏è –±–µ—Ä–≥–∞–º–æ—Ç, –ª–∏–º–æ–Ω, –∑–µ–ª–µ–Ω—å")
    ],
    "—Ç—Ä–∞–≤—è–Ω—ã–µ": [
        ("–î–µ–Ω—å –≤ –ø–∞—Ä–∫–µ", "üåø —Ç—Ä–∞–≤–∞, –±–∞–∑–∏–ª–∏–∫, —à–∞–ª—Ñ–µ–π, –∏–Ω–∂–∏—Ä"),
        ("–õ–µ—Å –≤ –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ", "üå≤ —à–∞–ª—Ñ–µ–π, –∫–æ—Ä–∏–∞–Ω–¥—Ä, –º–æ—Ö, —Ä–æ–º–∞—à–∫–∞"),
        ("–°–∞–Ω–¥–∞–ª –∏ —Ü–≤–µ—Ç—ã", "üåº –ª–∞–≤–∞–Ω–¥–∞, –∫—É–≤—à–∏–Ω–∫–∞, —Ä–æ–º–∞—à–∫–∞, —Å–∞–Ω–¥–∞–ª")
    ],
    "—Ü–≤–µ—Ç–æ—á–Ω—ã–µ": [
        ("–°–æ–ª–Ω–µ—á–Ω—ã–µ —Ü–≤–µ—Ç—ã (—Å–µ—Ä–¥—Ü–µ)", "üå∏ –∏–ª–∞–Ω–≥, –≥–∞—Ä–¥–µ–Ω–∏—è, —Ç—É–±–µ—Ä–æ–∑–∞, –∂–∞—Å–º–∏–Ω"),
        ("–ú–æ—Ä—Å–∫–æ–π —Ç—É–º–∞–Ω (—Å–µ—Ä–¥—Ü–µ)", "üåä –≥–∞—Ä–¥–µ–Ω–∏—è, —Ç—É–±–µ—Ä–æ–∑–∞, –∂–∞—Å–º–∏–Ω —Å–∞–º–±–∞–∫"),
        ("–õ–∞–≤–∞–Ω–¥–æ–≤—ã–π –≤–µ—á–µ—Ä", "üíú –ª–∞–≤–∞–Ω–¥–∞, –º—É—Å–∫–∞—Ç–Ω—ã–π –æ—Ä–µ—Ö, –≤–∞–Ω–∏–ª—å")
    ],
    "–≥—É—Ä–º–∞–Ω—Å–∫–∏–µ": [
        ("–ê–±—Å–µ–Ω—Ç –∏–∑ —á–µ—Ä–Ω–æ–π —Å–º–æ—Ä–æ–¥–∏–Ω—ã", "üçá —è–±–ª–æ–∫–æ, —Å–º–æ—Ä–æ–¥–∏–Ω–∞, –µ–∂–µ–≤–∏–∫–∞, –∞–º–±—Ä–∞, –∫–µ–¥—Ä"),
        ("–ü—Ä—è–Ω–∞—è —Ä–æ–∑–∞", "üåπ —Ä–æ–∑—ã, —Å–ø–µ—Ü–∏–∏, –±–æ–±—ã —Ç–æ–Ω–∫–∞, –ø–∞—á—É–ª–∏"),
        ("–ú–æ—Ä—Å–∫–æ–π —Ç—É–º–∞–Ω (–±–∞–∑–∞)", "ü•• –∫–æ–∫–æ—Å, –º–∏–Ω–¥–∞–ª—å, –ª–∞–¥–∞–Ω"),
        ("–î–µ–Ω—å –≤ –ø–∞—Ä–∫–µ (–±–∞–∑–∞)", "ü™µ –±–æ–±—ã —Ç–æ–Ω–∫–∞, –≥–≤–æ–∑–¥–∏–∫–∞, —Å–∞–Ω–¥–∞–ª")
    ],
    "–¥—Ä–µ–≤–µ—Å–Ω—ã–µ": [
        ("–õ–µ—Å –≤ –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ (–±–∞–∑–∞)", "ü™µ –¥–µ—Ä–µ–≤–æ, –±–∞–ª—å–∑–∞–º, —Å–ø–µ—Ü–∏–∏"),
        ("–ü—Ä—è–Ω–∞—è —Ä–æ–∑–∞ (–±–∞–∑–∞)", "üå∂ –ø–∞—á—É–ª–∏, –±–æ–±—ã —Ç–æ–Ω–∫–∞"),
        ("–°–∞–Ω–¥–∞–ª –∏ —Ü–≤–µ—Ç—ã", "ü™µ —Å–∞–Ω–¥–∞–ª"),
        ("–õ–∞–≤–∞–Ω–¥–æ–≤—ã–π –≤–µ—á–µ—Ä (–±–∞–∑–∞)", "üç¶ –≤–∞–Ω–∏–ª—å")
    ]
}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "üïØ –ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –≤—ã–±—Ä–∞—Ç—å —Å–≤–µ—á—É.

"
        "üß† –í–æ–ø—Ä–æ—Å 1: –ê –¥–ª—è –∫–∞–∫–æ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–ª–∏ –º–æ–º–µ–Ω—Ç–∞ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–≤–µ—á—É?
"
        "(–Ω–∞–ø—Ä–∏–º–µ—Ä: –¥–ª—è —Å–Ω–∞, —É—é—Ç–∞, —Ä–∞–±–æ—Ç—ã, —Ä–æ–º–∞–Ω—Ç–∏–∫–∏ –∏ —Ç.–¥.)"
    )
    context.user_data["step"] = 1

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    step = context.user_data.get("step", 1)

    if step == 1:
        context.user_data["purpose"] = update.message.text
        context.user_data["step"] = 2
        keyboard = [
            [InlineKeyboardButton("üçã –°–≤–µ–∂–∏–µ", callback_data="—Å–≤–µ–∂–∏–µ")],
            [InlineKeyboardButton("üåø –¢—Ä–∞–≤—è–Ω—ã–µ", callback_data="—Ç—Ä–∞–≤—è–Ω—ã–µ")],
            [InlineKeyboardButton("üå∏ –¶–≤–µ—Ç–æ—á–Ω—ã–µ", callback_data="—Ü–≤–µ—Ç–æ—á–Ω—ã–µ")],
            [InlineKeyboardButton("üçá –ì—É—Ä–º–∞–Ω—Å–∫–∏–µ", callback_data="–≥—É—Ä–º–∞–Ω—Å–∫–∏–µ")],
            [InlineKeyboardButton("ü™µ –î—Ä–µ–≤–µ—Å–Ω—ã–µ", callback_data="–¥—Ä–µ–≤–µ—Å–Ω—ã–µ")],
        ]
        await update.message.reply_text(
            "üëÉ –í–æ–ø—Ä–æ—Å 2: –ö–∞–∫–∏–µ –∞—Ä–æ–º–∞—Ç—ã –≤–∞–º –±–æ–ª—å—à–µ –ø–æ –¥—É—à–µ?",
            reply_markup=InlineKeyboardMarkup(keyboard)
        )

async def handle_button(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    category = query.data
    response = f"‚ú® –ü–æ–¥–±–æ—Ä–∫–∞ —Å–≤–µ—á–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ *{category}* (2680‚ÇΩ –∫–∞–∂–¥–∞—è):

"
    for name, desc in CANDLES[category]:
        response += f"‚Ä¢ {name} ‚Äî {desc}
"
    response += "
üõç –ó–∞–∫–∞–∑–∞—Ç—å –º–æ–∂–Ω–æ —É @Kamilla_Chrome"
    await query.edit_message_text(response, parse_mode="Markdown")

def main():
    app = ApplicationBuilder().token(os.environ["BOT_TOKEN"]).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))
    app.add_handler(CallbackQueryHandler(handle_button))
    app.run_polling()

if __name__ == "__main__":
    main()
